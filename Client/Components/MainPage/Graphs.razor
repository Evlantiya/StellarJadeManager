
<MudContainer Style="width:95%">

<ApexChart @ref="apexChart" TItem="Roll" Options="apexOptions" Height="700">
                <ApexPointSeries  TItem="Roll"
                    Items="RollData"
                    Name="Шанс 5⭐ по номеру крутки"
                    SeriesType="SeriesType.Area"
                    XValue="e=> e.rollnum"
                    YValue="e=>(decimal)e.chance"/>
                <ApexPointSeries  TItem="Roll"
                    Items="RollData"
                    Name="Шанс 5⭐"
                    SeriesType="SeriesType.Area"
                    XValue="e=>e.rollnum"
                    YValue="e=>(decimal) e.cumulative_chance"/>
        </ApexChart>
</MudContainer>

<MudButton OnClick="test">TEST</MudButton>

@code {

    private ApexChart<Roll> apexChart;
    private ApexChartOptions<Roll> apexOptions {get; set;}
    public List<Roll> RollData = new();
    public void test(){
        Console.WriteLine(0);
    }

    public async Task UpdateRollnumMarkerAsync(int rollNum)
    {
        apexOptions.Markers.Discrete.FirstOrDefault().DataPointIndex = rollNum-1;
        await apexChart.UpdateOptionsAsync(false, false, false);
    }

    protected override async Task OnInitializedAsync(){
        for(int i = 1; i < 91; i++){
            RollData.Add(
                new Roll{
                    rollnum = i,
                    chance=ConstChances.Chances_per_rollnum[i],
                    cumulative_chance=ConstChances.Cumulative_chances[i]
                }
            );
        }
        apexOptions = new ApexChartOptions<Roll>{
            
            Theme = new Theme
                {
                    Mode = Mode.Dark,
                    Palette = PaletteType.Palette1
                },
            Xaxis = new XAxis{
                TickAmount=16,
                Min=1,
                Max=90,
                Labels = new XAxisLabels{
                    Rotate = -45.0,
                }
            },
            Yaxis = new List<YAxis>{
                new YAxis
                {
                    ForceNiceScale = false,
                    Min=0,
                    Max=100,
                    Title = new AxisTitle{Text="Шанс 5⭐"},
                    SeriesName="Шанс 5⭐",
                    Labels = new YAxisLabels
                    {
                        Formatter = @"function (value) {return Number(value).toString()+'%';}",
                        MinWidth = 40
                    }
                },
                new YAxis
                {
                    ForceNiceScale = false,
                    Min=0,
                    Max=100,
                    Opposite = true,
                    Title = new AxisTitle{Text="Шанс 5⭐ по номеру крутки"},
                    SeriesName="Шанс 5⭐ по номеру крутки",
                    Labels = new YAxisLabels
                    {
                        MinWidth = 40,
                        Formatter = @"function (value) {return Number(value).toString()+'%';}"
                    }
                }
            },
            Chart = new Chart{
                Background = "transparent",
                Group = "pulls",
                Toolbar = new Toolbar {Show=false},
                Zoom = new Zoom {Enabled = false},
                
            },
            Annotations = new Annotations{
                Xaxis = new List<AnnotationsXAxis> { new AnnotationsXAxis{
                        X=73
                    }
                }
            },
            Markers = new Markers
            {
                Discrete = new List<MarkersDiscrete>() {
                    new MarkersDiscrete {
                        SeriesIndex = 1,
                        DataPointIndex = 1,
                        Size = 10,
                        FillColor = "var(--legendary-rarity-color)"
                    }
                }
            },
            Colors = new List<string> { "var(--mud-palette-primary)","var(--legendary-rarity-color)" }
            
            
        };
    }


    public class Roll
        {
        public int rollnum { get; set; }
        public double chance { get; set; }
        public double cumulative_chance { get; set; }

        }
    public double[] GetCumulativeSum(double[] numbers)
    {
        double[] result = new double[numbers.Length];
        double sum = 0;
        for (int i = 0; i < numbers.Length; i++)
        {
            sum += numbers[i];
            result[i] = sum;
        }
        return result;
    }
    
}